Lesson 4
========================================================

***

### coord trans 转换某个轴的范围
Notes:

```{r Scatterplots}
pf <- read.csv('pseudo_facebook.tsv',sep='\t')
library(ggplot2)
ggplot(aes(x = age, y = friend_count),data = pf) +
  geom_point(alpha = 1/20) +
  xlim(13,90)

ggplot(aes(x = age, y = friend_count),data = pf) +
  geom_point(alpha = 1/20) +
  xlim(13,90)+
  coord_trans(y = "sqrt")

ggplot(aes(x = age, y = friend_count),data = pf) +
  geom_jitter(alpha = 1/20, position = position_jitter(h=0)) +
  xlim(13,90)+
  coord_trans(y = "sqrt")

```

### alpha和jitter
Notes:

```{r Scatterplots}

ggplot(aes(x = age, y = friendships_initiated),data = pf) +
  geom_point(alpha = 1/20) +
  xlim(13,90)+
  coord_trans(y = "sqrt")

```

前面都是直接将两个变量用点画出来，即使做了转化变换或者抖动。

### 条件均值
Notes:
  一个变量的均值或者别的统计值随着另一个变量变化的情况
  比如平均朋友数量随着年龄的变化
  
  dplyr允许分割某个数据集，并对某块数据应用函数做转化

```{r Scatterplots}
install.packages("dplyr")
library(dplyr)

#方式一
#给数据集分组
age_groups <- group_by(pf,age)
#对分组后的数据集进行总结，将几个特征用变量保存起来 n()函数统计组内记录的个数,对age_groups数据集执行操作
pf.fc_by_age <- summarise(age_groups,
          friend_count_mean = mean(friend_count),
          friend_count_median = median(friend_count),
          n = n())
#对该数据集按照age从小到大排列
pf.fc_by_age <- arrange(pf.fc_by_age,age)
#显示数据集前几行
head(pf.fc_by_age)

#方式二
#%%这个符号允许把数据集和函数连接起来，代表对该数据集采用该函数处理
pf.fc_by_age <- pf %>%
  group_by(age) %>%
  summarise(friend_count_mean = mean(friend_count),
          friend_count_median = median(friend_count),
          n = n()) %>%
  arrange(age)
head(pf.fc_by_age)


```

结论：13岁的平均好友数比14岁的低，平均好友数峰值在16到17岁之间


### 绘制平均好友数随年龄变化的折线图
Notes:

```{r Scatterplots}
p <- ggplot(pf.fc_by_age, aes(x=age, y=friend_count_mean))
p + geom_line()

```

结论：年轻人有较高的平均好友数，30到60岁的人好友数在一百左右浮动，60多有一个异常值，还有80以上的年龄好友数波动很大，


### 将两幅图叠加在一起
Notes:

```{r Scatterplots}
#将一个平均的折线图覆盖到散点图上，fun.y指这个函数会被应用到y上
#将10%分位数点覆盖到散点图上
#将90%分位数点覆盖到散点图上
#将50%分位数点覆盖到散点图上
ggplot(aes(x=age,y=friend_count),data=pf) +
  xlim(13,90) + 
  geom_point(alpha = 1/20,
             position = position_jitter(h = 0),
             color = 'orange') +
  coord_trans(y = 'sqrt') +
  geom_line(stat = 'summary',fun.y = mean)+
  geom_line(stat = 'summary',fun.y = quantile, fun.args = list(probs = .1),linetype=2,color='blue')+
  geom_line(stat = 'summary',fun.y = quantile, fun.args = list(probs = .9),linetype=2,color='blue')+
  geom_line(stat = 'summary',fun.y = quantile, fun.args = list(probs = .5),color='blue')+
  coord_cartesian()

```

### 使用?coord_cartesian()来放大局部
Notes:

```{r Scatterplots}
#放大了部分图形
ggplot(aes(x=age,y=friend_count),data=pf) +
  coord_cartesian(xlim=c(13,70),ylim=c(0,1000))+
  geom_point(alpha = 1/20,
             position = position_jitter(h = 0),
             color = 'orange') +
  geom_line(stat = 'summary',fun.y = mean)+
  geom_line(stat = 'summary',fun.y = quantile, fun.args = list(probs = .1),linetype=2,color='blue')+
  geom_line(stat = 'summary',fun.y = quantile, fun.args = list(probs = .9),linetype=2,color='blue')+
  geom_line(stat = 'summary',fun.y = quantile, fun.args = list(probs = .5),color='blue')

```


### 前面将原始数据和一些汇总数据在一幅图片中展示，来获取一些有用信息，现在通过直方图展示另一些信息
比如大部分人低估了他们的好友数，那么他们到底低估了多少或者高估了多少呢
比如多少人完美的猜中了他们的好友数
或者是多少人高估了百分之10，低估了百分之十
Notes:

```{r Scatterplots}


```




